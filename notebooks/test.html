<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Denise Gutiérrez">

<title>Local Public Procurement: Data Building</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="test_files/libs/clipboard/clipboard.min.js"></script>
<script src="test_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="test_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="test_files/libs/quarto-html/popper.min.js"></script>
<script src="test_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="test_files/libs/quarto-html/anchor.min.js"></script>
<link href="test_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="test_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="test_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="test_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="test_files/libs/bootstrap/bootstrap-2ccb965d5e02a9f2fc6d99a2a884e68a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Local Public Procurement: Data Building</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Denise Gutiérrez </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="country-chile" class="level2">
<h2 class="anchored" data-anchor-id="country-chile">Country: Chile</h2>
</section>
<section id="general-data-features" class="level1">
<h1>General data features</h1>
<ul>
<li><p><strong>Structure</strong> The data of Chile is divided in two bodies of data: one for <em>tenders</em> and another for <em>purchase orders</em>, which I called <strong>purchases</strong> for simplicity.</p></li>
<li><p><strong>Temporal dimension</strong> We have data from 2007 until 2024. (We decided to stop in 2024 because we want to cover complete years and the year in which the stuy is being done is 2025). So, our study covers 18 years.</p></li>
<li><p><strong>Description</strong> The raw data comes by month, so we have 12 files for each year. If we multiply 12 <em>(number of months)</em> * 18 <em>(number of years in the analysis)</em>, we end up with 216 files. But these are 216 files just for the tenders files. We also have the purchase files by the same amount, so we have 432 files in total. This is:</p></li>
<li><p><strong>Tenders files</strong> : 216 files from 2007 to 2024.</p></li>
<li><p><strong>Purchases files</strong> : 216 files from 2007 to 2024.</p></li>
</ul>
<p>This raw data was fully downloaded on 25.02.2025.</p>
<p>As of 19.03.24, we are still working in the data building.</p>
</section>
<section id="tenders" class="level1">
<h1>Tenders</h1>
<section id="number-of-variables-in-the-raw-table" class="level3">
<h3 class="anchored" data-anchor-id="number-of-variables-in-the-raw-table">Number of variables in the raw table</h3>
<p>The <strong>raw table is</strong> a consolidated dataset that merges all 216 tenders files covering the 18 years of data.</p>
<p>Each <strong>tenders file</strong> contains 107 variables.</p>
<p>As of 16.07.25, the raw table contains <strong>109 variables.</strong></p>
<p>The additional two variables are:</p>
<ol type="1">
<li><p>Nombre producto genrico: this is a typo, so at the end it is not an additional variable. I fixed that problem while creating the final tables. I explain that later in the section <em>structure of tenders table.</em></p></li>
<li><p>Filename: it was a variable created by us to track where the files come from. This was not taken into account in any table.</p></li>
<li><p>In the notion table, we have 110 variables because I added te variable office_id in the buyers table (however, this variable is just in the buyers table and not in the raw data).</p></li>
</ol>
</section>
<section id="consistency-of-variables-in-the-raw-data-over-18-years" class="level3">
<h3 class="anchored" data-anchor-id="consistency-of-variables-in-the-raw-data-over-18-years">Consistency of variables in the raw data over 18 years</h3>
<p>I checked the files of 2007 and 2024 to check if the variables were the same over the years. This is what I found:</p>
<ol type="1">
<li><p>The variable <strong>Sector</strong> appears in 2024, but it does not appear in 2007. It was added at some point in time, but I do not know when. This was checked on 27.03.25: this variable started to appear in the year 2012 for only three entries (looking at the variable “fecha de creación”).</p></li>
<li><p>The variable <strong>UnidadMedida.1</strong> appears in 2007, but no longer appears in 2024. It was deleted at some point in time, but I do not know when. This was checked on 27.03.25: this variable appeared until the year 2014 (looking at the variable “fecha de creación”).</p></li>
<li><p>The variable <strong>Estado final Oferta</strong> appears in 2007, but no longer appears in 2024. It was deleted at some point in time, but I do not know when. This was checked on 27.03.25: this variable appeared until the year 2014 (looking at the variable “fecha de creación”).</p></li>
<li><p>The variable <strong>Codigo Estado Licitacion</strong> seems to have the same entry as the variable <strong>CodigoEstado</strong>. I need to <span class="math inline">\(\textcolor{blue}{CHECK}\)</span> this.</p></li>
</ol>
</section>
<section id="problems-while-creating-the-raw-table" class="level3">
<h3 class="anchored" data-anchor-id="problems-while-creating-the-raw-table">Problems while creating the raw table</h3>
<ol type="1">
<li><p>The files 2014-3 and 2014-4 were not taken into account because they do not open (it seems they have an error).</p></li>
<li><p>The other files in 2014 were taken into account. However, some of them have missing colums in relation to the rest of the files in the other years. In spite of this, we took the 2014 files into the final table (with “unionbyname=true”).</p></li>
<li><p>The file 2017-8 was not taken into account because it has an error.</p></li>
<li><p>We realized that the value “codigounidad” is not te lowest level of identification for a buyer because one unit can be located in differents communes, so we had to combine the information of the unit code with the commune to have another variable called “office”, so in that way we have the lowest level of identification.<br>
</p></li>
</ol>
<ul>
<li>Talking to Claudia Soto, she explained to us that it is a mistake in the data and that in fact each unit should be just in one commune. So, the office variable does not mae sense now (11.06.25). Instead, we need to check the units and what is the correct commune where they belong to.</li>
</ul>
<ol start="5" type="1">
<li>However, out of the 92,482,928 entries in the data, 2,272,884 do not have information of communes. We also have information of the address, but only for 118.060 values out of the total 2,272,884 missing. It gives us the chance to recover 5.2 % of the information, but it seems not to be worthwhile.</li>
</ol>
</section>
<section id="segmentation-of-the-raw-table-into-organized-tables" class="level3">
<h3 class="anchored" data-anchor-id="segmentation-of-the-raw-table-into-organized-tables">Segmentation of the raw table into organized tables</h3>
<p>The raw table was divided into structured tables for tenders, buyers, items, bids, and suppliers. In this context, the suppliers are actually bidders, but we refer to them as suppliers for consistency, as this allows us to later match them with the purchase data.</p>
<section id="tenders-table" class="level4">
<h4 class="anchored" data-anchor-id="tenders-table">Tenders table</h4>
<p>In this table, we have 63 variables.</p>
<p>For more information, see our database in DuckDB or the <a href="https://www.notion.so/dictionary-database-Chile-tenders-1dd9a6c5478f80c38522e1c26a35d8af">Notion raw table description</a>.</p>
<p>These are the most important variables or the ones that can help us in the analysis at this stage (18.07.25):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Number of values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>1.</strong> tender_id</td>
<td>id of the tender in the system</td>
<td>4,060,881</td>
</tr>
<tr class="even">
<td>tender_link</td>
<td>link containing all the information about the call (criteria, etc) important for strategic pp</td>
<td>4,060,686</td>
</tr>
<tr class="odd">
<td>tender_type_description</td>
<td>private or public and amount range</td>
<td>13 possible outcomes</td>
</tr>
<tr class="even">
<td>tender_status</td>
<td>status of the tender. e.g., awarded, suspended, etc.</td>
<td>6 possible outcomes</td>
</tr>
<tr class="odd">
<td><strong>5.</strong> tender_type</td>
<td>id of the type of tender</td>
<td>14 possible outcomes</td>
</tr>
<tr class="even">
<td>is_open_or_closed_call</td>
<td>open or closed call</td>
<td>1 = open; 0 = closed</td>
</tr>
<tr class="odd">
<td>tender_currency_id</td>
<td>id of the currency</td>
<td>6 possible outcomes</td>
</tr>
<tr class="even">
<td>is_it_construction</td>
<td>construction tenders</td>
<td>0 = no; 2 = yes</td>
</tr>
<tr class="odd">
<td>complaints_count</td>
<td>number of complaints</td>
<td>—</td>
</tr>
<tr class="even">
<td><strong>10.</strong> creation_date</td>
<td>tender creation date</td>
<td>—</td>
</tr>
<tr class="odd">
<td>number_of_bidders</td>
<td>number of bidders</td>
<td>—</td>
</tr>
</tbody>
</table>
</section>
<section id="buyers-table" class="level4">
<h4 class="anchored" data-anchor-id="buyers-table">Buyers table</h4>
</section>
<section id="items-table" class="level4">
<h4 class="anchored" data-anchor-id="items-table">Items table</h4>
</section>
<section id="bids-table" class="level4">
<h4 class="anchored" data-anchor-id="bids-table">Bids table</h4>
</section>
<section id="suppliers-bidders-table" class="level4">
<h4 class="anchored" data-anchor-id="suppliers-bidders-table">Suppliers (bidders) table</h4>
</section>
</section>
</section>
<section id="purchases" class="level1">
<h1>Purchases</h1>
<section id="number-of-variables-in-the-raw-table-1" class="level3">
<h3 class="anchored" data-anchor-id="number-of-variables-in-the-raw-table-1">Number of variables in the raw table</h3>
<p>The <strong>raw table is</strong> a consolidated dataset that merges all 216 tenders files covering the 18 years of data.</p>
<p>Each <strong>purchases file</strong> contains 79 variables. I checked the files of 2007 and 2024 to check if the variables were the same over the years. This is what I found:</p>
<ol type="1">
<li><p>The variable <strong>IdPlanDeCompra</strong> appears in 2007, but not in 2024. It was deleted at some point in time, but I do not know when. I need to <span class="math inline">\(\textcolor{blue}{CHECK}\)</span> this.</p></li>
<li><p>The variable <strong>Codigo_ConvenioMarco</strong> appears in 2024, but it does not appear in 2007. It was added at some point in time, but I do not know when. I need to <span class="math inline">\(\textcolor{blue}{CHECK}\)</span> this.</p></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>